---
title: "Open Research Survey Report <img src=\"logo.jpg\" alt=\"UKRN logo\" style = \"float: right; \"/>"
author: "Emma Wilson"
date: "`r Sys.Date()`"
output: 
    html_document:
      theme: cosmo
---

```{r select, include=FALSE}
# Choose the data to run the report on
choose <- c("all", "mrc", "uob", "babraham")[1]
```

---

```{r setup, include=FALSE}
# R packages
library(forcats)      # For factor reverse
library(grid)         # Plot arrangement
library(gridExtra)    # Plot arrangement
library(tidyverse)    # Tidyverse packages
# Icons
remotes::install_github("mitchelloharawild/icons")
library(icons)
download_fontawesome()
download_academicons()
# Functions
source("functions/format_distribution.R")       # Create a histogram of responses
source("functions/format_leadership.R")         # Format MajorleadershipRole for graph
source("functions/format_priority.R")           # Format OR area priority responses
source("functions/format_priority_training.R")  # Format OR area priority responses (subset)
source("functions/format_training.R")           # Format training responses for graph
source("functions/read_survey.R")               # Read in and format survey data
# KnitR
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r data, include=FALSE}
# Clean column text
col_order <- read_csv("data-helpers/colOrder.csv")
# MRC taxonomy
mrc_group <- read_csv("data-helpers/mrcTaxonomy.csv")

# Read in survey data
dat_mrc <- read_survey("data", "MRC") # MRC-funded institutions
dat_uob <- read_survey("data", "UoB") # University of Bristol
dat_bab <- read_survey("data", "Babraham") # Babraham Institute
# Bind into one dataframe
dat <- rbind(dat_mrc, dat_uob, dat_bab)

# Clear environment
rm(col_order, dat_bab, dat_mrc, dat_uob, mrc_group)

# Select relevant data
if(choose == "all"){
  dat <- dat
} else if(choose == "mrc"){
  dat <- filter(dat, Unit == "MRC")
} else if(choose == "uob"){
  dat <- filter(dat, Unit == "UoB")
} else if(choose == "babraham"){
  dat <- filter(dat, Unit == "Babraham")
}

# Discipline column factors
dat$Discipline <- as.factor(dat$Discipline)

# Format MajorLeadership Role Column
dat <- format_leadership(dat)

# Subset and format responses from those who want training
dat_training <- format_training(dat, training = "Yes")

# Subset and format responses from those who do not indicate they want training
dat_no_training <- format_training(dat, training = "No")

# Bind datasets together
dat_all_training <- rbind(dat_training, dat_no_training) %>%
  select(OR_Area, Response, Training)

# Factor levels
dat_all_training$Response <- factor(dat_all_training$Response,
                                    levels = c("Training provided",
                                               "Unknown familiarity",
                                               "Not familiar",
                                               "Familiar",
                                               "Already engage"))

# Create dataframe of topics ranked by priority
priority <- format_priority(dat)

# Subset only responses from those who would find training useful
priority_training <- format_priority_training(priority, dat_training)
```

# Aim
This survey aimed to investigate the engagement of health and life sciences researchers with open research practices and training. The results of this survey will be used to inform priorities for reseacher training in five different open research areas:

  * Open access publishing
  * Sharing of open code and materials
  * Open data and data sharing
  * Publishing preprints
  * Preregistration and registered reports

# Survey Data

```{r, echo=FALSE, results='asis', warning=FALSE, message=FALSE}
p1 <- dat %>% group_by(Discipline) %>% count(Unit) %>%
  ggplot(aes(x = Unit, y = n, label = n)) +
  geom_bar(aes(fill = Discipline), stat = "identity") +
  scale_fill_manual(values = c("#28295B", "#4E4F86", "#6e6e6e")) +
  ylim(0, nrow(dat)) +
  theme(legend.position="right", legend.text = element_text(size = 7)) +
  xlab("Organisation\n(a)") + ylab("Number of Responses") +
  geom_text(aes(group = Discipline), size = 3, position = position_stack(vjust = 0.5), color = "white") +
  theme(plot.title = element_text(hjust = 0.5))

p2 <- count(dat, Leadership) %>%
  ggplot(aes(x = Leadership, y = n, label = n)) +
  geom_bar(fill = "#13A89E", stat = "identity") +
  ylim(0, nrow(dat)) +
  xlab("Leadership role\n(b)") + ylab("Number of Responses") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  geom_text(size = 3, position = position_stack(vjust = 0.5), color = "white") +
  theme(plot.title = element_text(hjust = 0.5))

p2_2 <- count(dat, Leadership) %>%
  ggplot(aes(x = Leadership, y = n, label = n)) +
  geom_bar(fill = "#13A89E", stat = "identity") +
  ylim(0, nrow(dat)) +
  xlab("Leadership role") + ylab("Number of Responses") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  geom_text(size = 3, position = position_stack(vjust = 0.5), color = "white") +
  theme(plot.title = element_text(hjust = 0.5))

if(choose == "all"){
  # Number of responses text
  cat('This report summarises', nrow(dat), 'survey responses from life and health sciences researchers at Medical Research Council (MRC)-funded institutions, The University of Bristol, and The Babraham Institute. \n\n')
  # Plots
  grid.arrange(p1, p2, nrow = 1, widths = c(4, 2))
  # Plot caption
  cat('\n\n<em><b>Figure 1:</b> Breakdown of survey responses by organisation and research discipline (a) and number of respondents with a major leadership role (b). A major leadership role was defined as running a group/lab, directing a school/organisation, or similar.</em>\n\n')
} else if(choose == "mrc"){
  # Number of responses text
  cat('This report summarises', nrow(dat), 'survey responses from life and health sciences researchers at Medical Research Council (MRC)-funded institutions. \n\n')
  # Plots
  grid.arrange(p1, p2, nrow = 1, widths = c(4, 2))
  # Plot caption
  cat('\n\n<em><b>Figure 1:</b> Breakdown of survey responses by organisation and research discipline (a) and number of respondents with a major leadership role (b). A major leadership role was defined as running a group/lab, directing a school/organisation, or similar.</em>\n\n')
} else if(choose == "uob"){
  # Number of responses text
  cat('This report summarises', nrow(dat), 'survey responses from life and health sciences researchers at The University of Bristol.')
  # Plot
  grid.arrange(p2, nrow = 1, widths = c(2))
  # Plot caption
  cat('\n\n<em><b>Figure 1:</b> Breakdown of survey responses from researchers with a major leadership role. A major leadership role was defined as running a group/lab, directing a school/organisation, or similar.</em>\n\n')
} else if(choose == "babraham"){
  # Number of responses text
  cat('This report summarises', nrow(dat), 'survey responses from life sciences researchers at The Babraham Institute.')
  # Plot
  grid.arrange(p2, nrow = 1, widths = c(2))
  # Plot caption
  cat('\n\n<em><b>Figure 1:</b> Breakdown of survey responses from researchers with a major leadership role. A major leadership role was defined as running a group/lab, directing a school/organisation, or similar.</em>\n\n')
} else {
  cat('Error: Please choose a valid data breakdown.')
}
```

# Open Research Training
Survey respondents were asked to describe their familiarity with the five open research areas, whether they thought they would find training useful, and if they thought their institution already provided sufficient training.

```{r training-plot, echo=FALSE}
dat_all_training %>% group_by(OR_Area, Training) %>% count(Response) %>%   
  ggplot(aes(x = Training, y = n, fill = forcats::fct_rev(Response)))+
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(~ OR_Area) +
  scale_fill_manual(name = "Response", values = c("#28295B", "#4E4F86", "#EC008C", "#6e6e6e", "#13A89E")) +
  theme(legend.position="bottom", legend.text = element_text(size = 7)) +
  xlab("Would Find Training Useful") + ylab("Number of Responses") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(label = n, group = OR_Area, Training), size = 3, position = position_stack(vjust = 0.5, reverse = TRUE), color = "white")
```

<em><b>Figure 2:</b> Breakdown of responses related to training in the five open research areas.</em>

<!-- Include logic in figure caption -->

# Priority of Training Topics
Survey respondents were asked to rank in order of priority the open research areas they think researchers would most benefit from. They could select from the five open research areas and up to 3 areas of their own choosing.

```{r priority-plot, echo=FALSE}
priority %>% group_by(OR_Area) %>% count(Rank) %>%
  ggplot(aes(x = OR_Area, y = n, fill = forcats::fct_rev(Rank))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_manual(name = "Rank", 
                    values = c("#28295B", "#4E4F86", "#13A89E", "#ed68b7", "#EC008C", "#6e6e6e")) +
  theme(legend.position="right") +
  xlab("Open Research Areas") + ylab("Number of Responses") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(group = OR_Area, label = n), size = 3, position = position_stack(vjust = 0.5, reverse = FALSE), color = "white")
```

<em><b>Figure 3: </b>Priority ranking of each of the five open research areas. 1 is highest priority and 8 is lowest. Where an area has been ranked 6-8, the number of responses is aggregated.</em>

A graph showing how the subset of respondents who said they would find Open Research training useful ranked the priority of research training in that area is shown in figure 4.

```{r priority-training-plot, echo=FALSE}
priority_training %>% group_by(OR_Area) %>% count(Rank) %>%
  ggplot(aes(x = OR_Area, y = n, fill = forcats::fct_rev(Rank))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_manual(name = "Rank", 
                    values = c("#28295B", "#4E4F86", "#13A89E", "#ed68b7", "#EC008C", "#6e6e6e")) +
  theme(legend.position="right") +
  xlab("Open Research Areas") + ylab("Number of Responses") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(group = OR_Area, label = n), size = 3, position = position_stack(vjust = 0.5, reverse = FALSE), color = "white")
```

<em><b>Figure 4: </b>Priority ranking of each of the five open research areas, subsetted to only show responses from researchers who would find training in each area useful. 1 is highest priority and 8 is lowest. Where an area has been ranked 6-8, the number of responses is aggregated.</em>

# Summary of Free Text Responses


---

[`r fontawesome("github")` GitHub repository](https://github.com/UKRN-Open-Research/survey-reports) | `r academicons("open-data")` Survey data